<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<!--<script src="js/observable.js"></script>-->
	<!--<script src="js/module.js"></script>-->
	<!--<script src="js/parse.js"></script>-->
	<!--<script src="js/compile.js"></script>-->
</head>
<body>


<h1>{{ tit > le }}</h1>

<script>
let x = 100;
let y = 200;

"<div-script>askdljflksdfsd</div-script>";

</script>


<script id="2">
let a = 100;
let b = 200;
</script>


<script id="main">
let url = "./todomvc-app/index.html";

url = "./dom-parser.html";

fetch(url).then(res => res.text()).then(html => {


	class $Element {
		constructor() {
			this.tagName = null;
			this.attrs = "";
			this.childNodes = [];
			this.outerHTML = "";
		}

		appendChild(node) {
			this.childNodes.push(node);
		}
	}

	function createElement(tagName) {
		let e = new $Element();
		e.tagName = tagName.trim();
		return e;
	}


	console.log(html);


	// let html = document.documentElement.outerHTML;
	// let html = `<div  id="skjdflksd"      >asdklf < jasklds</div>`

	// let string = `(?:'[^']*'|"[^"]*")`;


	/// <tag>

	/// <tag >

	/// <tag skjdsk >

	/// <tag or <tag(?:>|\s[^>]*>)

	/// ex) <!-- [^-]*|-[^-]*|--[^>]*|. -->

	// let tag_re = /([<]!--(?:.*?)-->)|(<script[^>]*>)|(<style(?:.*?)<[/]style>)|(<([^>\s]+)(\s+([^>]+))?>)|[^<]+|./g;


	let tagName = /(\/?)([^>\s]+)/.source;
	let tagAttrs = /((?:\s[^>]*)?)(\/)?/.source;

	let tag_re = new RegExp(`([<]!--(?:.*?)-->)|(<${tagName}${tagAttrs}>)|[^<]*|.`, "g");

	let i = 0;

	let root = new $Element();
	root.tagName = "#root";
	let stack = [root];

	html.replace(tag_re, function(a, comment, outerHTML, closed, tagName, attrs) {
		let args = Array.from(arguments);

		if (comment) {
			return a;
		}

		/// Element Node
		if (tagName) {

			let parent = stack[stack.length - 1];

			if (parent.tagName === "script" && !(tagName === "script" && closed)) {
				// console.log("!!!!!!!!!!!!!!!!!!!", args);
				return a;
			}

			if (parent.tagName === "style" && !(tagName === "style" && closed)) {
				// console.log("!!!!!!!!!!!!!!!!!!!", args);
				return a;
			}

			if (closed) {
				// @TODO: 같은 태그 이름이 나올때 까찌 닫는게 맞는거...
				stack.pop();
				return a;
			}


			let e = createElement(tagName);
			e.outerHTML = outerHTML;

			if (attrs) {
				e.attrs = attrs.trim();
			}

			parent.appendChild(e);


			// void Elements
			switch (tagName) {
				case "meta":
				case "link":
				case "input":
					return a;
			}

			// !doctype ...
			if (tagName[0] === "!") {
				return a;
			}

			stack.push(e);
			return a;
		}

		/// Text Node
		// if (!tagName) {
		// 	console.log(args);
		// }

		return a;
	});


	function render(e, tab) {
		console.log(tab + e.outerHTML, e.tagName, e.attrs);
		e.childNodes.forEach(c => render(c, tab + "  "));
		console.log(tab + "</" + e.tagName + ">");
	}

	console.log(stack);

	render(root, "");


	// console.log(html);


});
</script>


</body>
</html>