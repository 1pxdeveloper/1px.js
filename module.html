<!DOCTYPE html>
<html>
<head lang="en">
</head>


<body>

<div class="tab" #tab [name]="'키보드'" (click)="template = tab.name" [class.selected]="template === tab.name">${tab.name}</div>
<div class="tab" #tab [name]="'설정'" (click)="template = tab.name" [class.selected]="template === tab.name">${tab.name}</div>
<div class="tab" #tab [name]="'테마'" (click)="template = tab.name" [class.selected]="template === tab.name">${tab.name}</div>
<div class="tab" #tab [name]="'실험실'" (click)="template = tab.name" [class.selected]="template === tab.name">${tab.name}</div>


<script>
	var _module = {};
	var _component = {};
	var _recipe = {};

	function itself(v) {
		return function() { return v; }
	}

	function $component(name) {
		return (_component[name] = _component[name] || {});
	}

	function $recipe(name) {
		return (_recipe[name] = _recipe[name] || {});
	}

	function define(module, name, recipe) {
		$recipe(module.name)[name] = recipe;
	}

	function block(module, name, recipe) {
//		var module = $block(module.name)["block/"+name] = recipe;
	}

	function require(module, name, stack) {
		stack = stack || [];

		var modules = module.dependencies.concat([module.name]);
		var index = modules.length;
		while(index--) {
			var module_name = modules[index];
			var component = $component(module_name);
			var recipe = $recipe(module_name);

			if (component.hasOwnProperty(name)) {
				return component[name];
			}

			if (recipe.hasOwnProperty(name) === false) {
				continue;
			}

			if (stack.indexOf(name) >= 0) {
				stack.unshift(name);
				throw Error("circurlar defined. " + stack.join(" <- "));
			}

			stack.unshift(name);
			var result = component[name] = invoke(module, recipe[name], stack);
			stack.pop();
			return result;
		}

		throw Error("not defined. " + name);
	}

	function invoke(module, recipe, stack) {
		stack = stack || [];

		var inject = recipe.slice();
		var factory = inject.pop();

		return defaultInvoker(module, factory, inject, stack);
	}

	function defaultInvoker(module, factory, inject, stack) {
		var args = [];
		inject.forEach(function(name) {
			args.push(require(module, name, stack));
		});

		return factory.apply(null, args);
	}

	function controllerInvoker(module, factory, inject, stack) {
		var args = [];
		inject.forEach(function(name) {
			args.push(require(module, name, stack));
		});

		return factory.apply(null, args);
	}


	function Module(name, dependencies) {
		this.name = name;
		this.dependencies = dependencies;
	}
	Module.prototype = {
		require: function(name) {
			return require(this, name);
		},

		factory: function(name, recipe) {
			return define(this, name, recipe);
		},

		value: function(name, value) {
			return define(this, name, itself(value));
		}
	};

	function $module(name, dependencies, define) {
		var module = _module[name] = _module[name] || new Module(name, []);
		if (arguments.length === 1) {
			return module;
		}

		for (var i = 0, len = dependencies.length; i < len; i++) {
			var name = dependencies[i];
			if (!module.dependencies[name]) {
				module.dependencies.push(name);
			}
			module.dependencies[name] = name;
		}
		if (typeof define === "function") {
			define.call(null, module);
		}

		return module;
	}

	$module("1px", [], function(module) {
		module.factory("hello", [function() {
			return function() {
				return "hello";
			}
		}]);
	});

	$module("rest", ["1px"], function(module) {
		module.factory("hello", [function() {
			return function() {
				console.log("rest!!" + "http");
			}
		}]);

		module.factory("http", ["hello", function(hello) {
			return function() {
				console.log(hello() + "http");
			}
		}]);
	});

	$module("rest2", ["1px", "rest"], function(module) {
		module.factory("http2", ["hello", "http", function(hello, http) {
			return function() {
				console.log(hello() + http() + "http2");
			}
		}]);
	});


	var http = $module("rest2").require("http2");

	console.log(http);
	http();

</script>


</body>
</html>