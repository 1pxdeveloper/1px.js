<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>1px.js • TodoMVC</title>
	<!--<link rel="stylesheet" href="node_modules/todomvc-common/base.css">-->
	<!--<link rel="stylesheet" href="node_modules/todomvc-app-css/index.css">-->
	<!-- CSS overrides - remove if you don't need it -->
	<link rel="stylesheet" href="css/app.css">

	<script src="../js/observable.js"></script>
	<script src="../js/module.js"></script>
	<script src="../js/watch.js"></script>
	<script src="../js/parse.js"></script>
	<script src="../js/compile.js"></script>
	<script src="../js/component.js"></script>
	<script src="../js/util.js"></script>

</head>
<body>

<todo-app></todo-app>

<web-component name="todo-app">
	<template>
		<section class="todoapp">
			<header class="header">
				<h1>todos</h1>
				<p>{{ test | html }}</p>
				<form (submit)="addTodo($form.newTodo.value); $form.reset()" $form>
					<input name="newTodo" class="new-todo" placeholder="What needs to be done?" autofocus>
				</form>
			</header>

			<!-- This section should be hidden by default and shown when there are todos -->
			<section class="main" [hidden]="todos.length === 0">
				<input id="toggle-all" class="toggle-all" type="checkbox" [(checked)]="allChecked"
					   (input)="toggleAll(allChecked)">
				<label for="toggle-all">Mark all as complete</label>
				<ul class="todo-list">
					<li *repeat="todos as todo, index" [class.completed]="todo.completed"
						[class.editing]="todo === editingTodo">
						<div class="view">
							<input class="toggle" type="checkbox" [(checked)]="todo.completed">
							<label (dblclick)="setEditingTodo(todo)">{{ todo.title }}</label>
							<button class="destroy" (click)="removeTodo(todo)"></button>
						</div>
						<form (submit)="applyTodo(todo, $el.title.value)">
							<input name="title" class="edit" [value]="todo.title" (blur)="$el.parentNode.submit()"
								   focus()="todo === editingTodo">
						</form>
					</li>
				</ul>
			</section>

			<!-- This footer should hidden by default and shown when there are todos -->
			<footer class="footer">
				<!-- This should be `0 items left` by default -->
				<span class="todo-count"><strong>{{ num_items_left || 0 }}</strong> {{ num_items_left === 1 ? "item" : "items" }} left</span>
				<!-- Remove this if you don't implement routing -->
				<ul class="filters">
					<li>
						<a [class.selected]="filter === 'all'" href="#/">All</a>
					</li>
					<li>
						<a [class.selected]="filter === 'active'" href="#/active">Active</a>
					</li>
					<li>
						<a [class.selected]="filter === 'completed'" href="#/completed">Completed</a>
					</li>
				</ul>
				<!-- Hidden if no completed items are left ↓ -->
				<button class="clear-completed" [hidden]="num_items_left> 0" (click)="clearCompleted()">Clear
					completed
				</button>
			</footer>
		</section>
	</template>
</web-component>

<script>module.pipe("hello", function() {
	return function() {
		return Array.from(arguments).join("@");
	}
});
</script>

<script>module.pipe("html", function() {
	return function(value) {
		if (value === undefined) value = "";
		let h = document.createElement("div");
		h.innerHTML = String(value);
		return DocumentFragment.from(h.childNodes);
	}
});
</script>


<script>module.component("todo-app", function() {

	// 여기는 1번만 실행된다.

	return {
		init($) {
			window.app = this;

			this.todos = [
				{
					title: "123",
					completed: true,
				},
				{
					title: "Taste JavaScript 345",
					completed: true,
				},
				{
					title: "JavaScript",
					completed: false
				}
			];

			this.num_items_left = null;
			this.allChecked = null;
			this.editingTodo = null;

			$`this.num_items_left = this.todos.filter(todo => !todo.completed).length;`;
			$`this.allChecked = !this.num_items_left`;

			/// @TODO: Route Service
			this.on$(window, "popstate").subscribe(event => {
				if (this[location.hash]) {
					this[location.hash]();
				}
			});

			this.filter = "all";
		},

		/// Route Service
		"#/": function() {
			this.filter = "all";
			console.log("all!!!!!!!!!!");
		},

		"#/active": function() {
			this.filter = "active";
			console.log("active!!!!!!!!!!");
		},

		"#/completed": function() {
			this.filter = "completed";
			console.log("completed!!!!!!!!!!");
		},


		/// Methods
		addTodo(title) {
			title = title.trim();
			if (!title) return;

			this.todos.unshift({
				title: title,
				completed: false,
			});
		},

		toggleAll(allChecked) {
			this.todos.forEach(todo => todo.completed = allChecked);
		},

		removeTodo(todo) {
			let index = this.todos.indexOf(todo);
			if (index >= 0) this.todos.splice(index, 1);
		},

		setEditingTodo(todo) {
			this.editingTodo = todo;
		},

		applyTodo(todo, title) {
			this.editingTodo = null;
			title = (title || "").trim();
			if (!title) return;
			todo.title = title;
		},

		clearCompleted() {
			this.todos = this.todos.filter(todo => !todo.completed);
		}
	}
})</script>


<!-- Scripts here. Don't remove ↓ -->
<!--<script src="node_modules/todomvc-common/base.js0"></script>-->
<script src="js/app.js"></script>
</body>
</html>
